<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> MedCity | Saúde em primeiro lugar</title>
    <link rel="icon" href="../../imagens/medcity-logo-icon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="../../css/style.css"/>
    <script src="https://kit.fontawesome.com/fb10b6ad7c.js" crossorigin="anonymous"></script>

    <script>
		function preload(el, interval) {
			var op = 1;
			var timer = setInterval(function () {
				if (op <= 0.7) {
					clearInterval(timer);
					el.style.display = 'none';
					el.className = '';
				}
				el.style.opacity = op;
				op -= op * 0.1;
			}, interval);
		}
		window.onload = function () {
			var div = document.getElementById('preload');
			preload(div, 500);
		};
	</script>
	<style>
	.menu-mobile{
        	background-color: #0abbb5;
    	}
	.class-2{
            background-color: #3acbc6;
            color: white;
            font-weight: bolder;
            font-size: 1.1rem;
        } 

        .class-3{
            background-color: #6adbd9;
            color: white;
            font-weight: bolder;
            font-size: 1.1rem;
        }
        .class-4{
            background-color: #86e2e1;
            color: cadetblue;
            font-weight: bolder;
            font-size: 1.1rem;
        }
	.class-5{
            background-color: #cafcfb;
            color: cadetblue;
	    font-weight: bolder;
            font-size: 1.1rem;

        }
    </style>

</head>
<body>
    
    <header>
        <address>
            <i class="fa fa-phone"></i>Central de Atendimento: (34) 1111-1111 | <i class="fa fa-envelope-o"></i>email: medcity_contact@ficmail.com 
        </address>
	<div class="menu-mobile sticky-top">
		<a href="../../../"><img src="../../imagens/medcity-logo-alt.png" class="img-fluid" width="200"></a>
	   	<button class="btn btn-outline-light" id="toggle-btn"><i class="fas fa-bars"></i></button>
	</div>
    </header>
    <nav id="mobile-nav" class="col-12 col-sm-12 col-md-12 col-lg-7 col-lg-offset-2">
		<a class="nav-link text-center text-white class-2" href="../galeria">Galeria de Fotos</a>
                <a class="nav-link text-center text-white class-3" href="../cadastro">Cadastro de Endereço</a>
                <a class="nav-link text-center text-white class-4" href="../agendamento">Agendamento</a>
		<a class="nav-link text-center text-info class-5" href="../../../index.html">Login</a>
    </nav>
    <div id="preload" class="preload"></div>
    <div class="container">
	<div class="menu-desk">
        <nav class="navbar navbar-expand-lg sticky-top bg-white d-flex justify-content-between">
            <a class="navbar-brand" href="../../../"><img src="../../imagens/medcity-logo.png"></a>
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="../../../index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="../galeria">Galeria de Fotos</a></li>
                <li class="nav-item"><a class="nav-link" href="../cadastro">Cadastro de Endereço</a></li>
                <li class="nav-item"><a class="nav-link" href="../agendamento">Agendamento</a></li>
            </ul>
            <button type="button" class="btn btn-outline-primary" id="login-btn">Login <i class="fa fa-user-circle-o"></i></button>
        </nav>
	</div>
        <main>
            <article id="string1" style="color: #80cbc4; text-align: center; padding-top: 2%;">
                <h2>Bem-vindo ao Setor de Agendamento!</h2>
                <h4>Para começarmos, por favor, insira as informações pessoais a seguir.</h3>
            </article>
            <article id="string2" style="color: #80cbc4; text-align: center; padding-top: 2%; display: none;">
                <h2>Muito Bem! Chegamos à segunda etapa.</h2>
                <h4>Agora são necessários os dados relacionados à consulta. Vamos lá...</h3>
            </article>
            <form method="POST" action="agendamento.php" class="addForm central">
                <img src="../../imagens/medcity-logo-alt.png" class="img-fluid" id="logo-login" required>
                <div class="row first">
                    <div class="col-md-12 gy-3">
                        <label for="nome" class="form-label">Nome</label>
                        <input type="text" id="nome" name="nome" class="form-control" required>
                    </div>
                    <div class="col-md-12 gy-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" id="email" name="email" class="form-control" required>
                    </div>
                    <div class="col-md-12 gy-3">
                        <label for="cep" class="form-label">Sexo</label>
                        <select id="sexo" name="sexo" class="form-select">
                            <option value=""></option> 
							<option value="M">Masculino</option> 
							<option value="F">Feminino</option>
                            <option value="F">Outro</option>
                        </select>
                    </div>
                    <div class="col-md-12 gy-4 justify-content-end">
                        <button id="avancar" class="btn btn-primary" type="submit">Avançar <i class="fa fa-angle-double-right"></i></button>
                    </div>
                </div> 
                <div class="row second">
                    <div class="col-md-12 gy-3">
                        <label for="especialidade" class="form-label">Especialidade Médica</label>
                        <select id="especialidade" name="especialidade" class="form-select" required>
                            <option value=""></option>
                        </select>
                    </div>
                    <div class="col-md-12 gy-3">
                        <label for="medico" class="form-label">Médico(a) Especialista</label>
                        <select id="medico" name="medico" class="form-select" required>
                            <option value=""></option>
                        </select>
                    </div>
                    <div class="col-md-12 gy-3">
                        <label for="data" class="form-label">Data da Consulta</label>
                        <input type="date" id="data" name="data" class="form-control" required>
                    </div>  
                    <div class="col-md-12 gy-3">
                        <label for="hora" class="form-label">Horário da Consulta</label>
                        <select id="hora" name="hora" class="form-select" required>
                            <option value=""></option>
                        </select>
                    </div>
		    <div class="col-md-12 gy-3">
                        <button id="voltar" class="btn btn-primary col-md-5" type="button"><i class="fa fa-angle-double-left"></i> Voltar</button>
                    	<button class="btn btn-primary col-md-5" type="submit">Enviar</button>
                    </div>

                </div>
            </form>
        </main>
    </div>
        <footer class="footer">
                <p id="fp">© 2022 | Todos os direitos reservados | Desenvolvido por Ana Paula Araújo Botelho</p>
        </footer>
 
    <script>
        var nome = document.querySelector("#nome");
        var email = document.querySelector("#email");
        var sexo = document.querySelector("#sexo");
        var avancarBtn = document.querySelector("#avancar");
        var voltarBtn = document.querySelector("#voltar");
        var especs = document.getElementById("especialidade");
        var button = document.querySelector("#login-btn");
        var data = document.getElementById("data");

        avancarBtn.onclick = function(){
            if(nome.value == ''|| email.value == '' || sexo.value == ''){
                alert('Ops...Precisamos de todos os campos para avançar');
            }else{
                var first = document.querySelector(".first");
                var second = document.querySelector(".second");
                var string1 = document.querySelector("#string1");
                var string2 = document.querySelector("#string2");

                first.style.display = "none";
                second.style.display = "block"
                string1.style.display = "none";
                string2.style.display = "block";

                let meuForm = document.querySelector("form");
                let formData = new FormData(meuForm);

                let xhr = new XMLHttpRequest();
                xhr.open("POST", "especialidades.php");                

                xhr.onload = function () {                
                    // verifica o código de status retornado pelo servidor
                    if (xhr.status != 200) {
                        console.error("Falha inesperada: " + xhr.responseText);
                        return;
                    }
            
                    // converte a string JSON para objeto JavaScript
                    try {
                        var response = JSON.parse(xhr.responseText);
                    }
                    catch (e) {
                        console.error("String JSON inválida: " + xhr.responseText);
                        return;
                    }

                    document.getElementById("especialidade").innerHTML = "";
                    var campoSelect = document.getElementById("especialidade");
                    var option = document.createElement("option");
                    option.text = "";
                    option.value = "";
                    option.setAttribute('selected', true);
                    campoSelect.add(option);

                    for (let i = 0; i < response.length; i++)
                    {   
                        var campoSelect = document.getElementById("especialidade");
                        var option = document.createElement("option");
                        option.text = response[i];
                        option.value = response[i];
                        campoSelect.add(option);
                    }
                };

                xhr.onerror = function () {
                    console.error("Erro de rede - requisição não finalizada");
                };

                xhr.send(formData);
            }
        }

        voltarBtn.onclick = function(){
            var first = document.querySelector(".first");
            var second = document.querySelector(".second");
            var string1 = document.querySelector("#string1");
            var string2 = document.querySelector("#string2");

            first.style.display = "block";
            second.style.display = "none"
            string1.style.display = "block";
            string2.style.display = "none";
        }

        especs.onchange = function (){
            let meuForm = document.querySelector("form");
            let formData = new FormData(meuForm);

            let xhr = new XMLHttpRequest();
            xhr.open("POST", "medicos.php");                

            xhr.onload = function () {                
                // verifica o código de status retornado pelo servidor
                if (xhr.status != 200) {
                    console.error("Falha inesperada: " + xhr.responseText);
                    return;
                }
        
                // converte a string JSON para objeto JavaScript
                try {
                    var response = JSON.parse(xhr.responseText);
                }
                catch (e) {
                    console.error("String JSON inválida: " + xhr.responseText);
                    return;
                }

                document.getElementById("medico").innerHTML = "";
                var campoSelect = document.getElementById("medico");
                var option = document.createElement("option");
                option.text = "";
                option.value = "";
                option.setAttribute('selected', true);
                campoSelect.add(option);

                for (let i = 0; i < response.length; i++)
                {   
                    var campoSelect = document.getElementById("medico");
                    var option = document.createElement("option");
                    option.text = response[i].nome;
                    option.value = response[i].codigo;
                    campoSelect.add(option);
                }
            };

            xhr.onerror = function () {
                console.error("Erro de rede - requisição não finalizada");
            };

            xhr.send(formData);
        }

        data.onchange = function (){
            let meuForm = document.querySelector("form");
            let formData = new FormData(meuForm);

            let xhr = new XMLHttpRequest();
            xhr.open("POST", "horarios.php");                

            xhr.onload = function () {                
                // verifica o código de status retornado pelo servidor
                if (xhr.status != 200) {
                    console.error("Falha inesperada: " + xhr.responseText);
                    return;
                }
        
                // converte a string JSON para objeto JavaScript
                try {
                    var response = JSON.parse(xhr.responseText);
                }
                catch (e) {
                    console.error("String JSON inválida: " + xhr.responseText);
                    return;
                }

                document.getElementById("hora").innerHTML = "";
                var campoSelect = document.getElementById("hora");
                var option = document.createElement("option");
                option.text = "";
                option.value = "";
                option.setAttribute('selected', true);
                campoSelect.add(option);

                var horas = ['8', '9', '10', '11', '13', '14', '15', '16', '17'];

                for (let i = 0; i < horas.length; i++)
                {   
                    let aux = 1;
                    for (let j = 0; j < response.length; j++){
                        if (horas[i] == response[j]){
                            aux = aux * 0;
                        }
                    }
                    if (aux == 1){
                        var campoSelect = document.getElementById("hora");
                        var option = document.createElement("option");
                        option.text = horas[i] + ":00";
                        option.value = horas[i];
                        campoSelect.add(option);
                    }
                }
            };

            xhr.onerror = function () {
                console.error("Erro de rede - requisição não finalizada");
            };

            xhr.send(formData);
        }
        
        button.onclick = function(){
            window.location.href = "../../../index.html";
        }


    </script>
	<script>
		function data(){
		    var data = new Date();
		    var dia = String(data.getDate() + 1).padStart(2, '0');
		    var mes = String(data.getMonth() + 1).padStart(2, '0');
		    var ano = data.getFullYear();
		    dataAtual = ano + '-' + mes + '-' + dia;
		
		    var input = document.getElementById("data");
        	    input.min = dataAtual;
		}
		
		var inputdata = document.getElementById("data");
		inputdata.onclick = () => data();
	</script>
	<script>
        var button = document.querySelector("#toggle-btn");

        button.onclick = function(){
            let nav = document.getElementById("mobile-nav");
            if(nav.style.display == "none"){
                nav.style.display = "block";
            }else{
                nav.style.display = "none";
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>
